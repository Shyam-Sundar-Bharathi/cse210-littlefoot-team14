!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).littlefoot={})}(this,(function(t){"use strict";var e=function(){return e=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},e.apply(this,arguments)};function n(t,e){t.classList.add(e)}function o(t,e){t.classList.remove(e)}function r(t,e){return t.classList.contains(e)}"function"==typeof SuppressedError&&SuppressedError;var i,u={};function c(){if(i)return u;return i=1,Object.defineProperty(u,"__esModule",{value:!0}),u.getStyle=function(t,e){var n,o=((null===(n=t.ownerDocument)||void 0===n?void 0:n.defaultView)||window).getComputedStyle(t);return o.getPropertyValue(e)||o[e]},u}var a,l=c(),s={};function f(){if(a)return s;a=1,Object.defineProperty(s,"__esModule",{value:!0}),s.pixels=function t(u,c){var a,l,s=null!==(l=null===(a=null==c?void 0:c.ownerDocument)||void 0===a?void 0:a.defaultView)&&void 0!==l?l:window,f=s.document.documentElement||s.document.body,d=function(t){var e,n=t||"0",o=Number.parseFloat(n),r=n.match(/[\d-.]+(\w+)$/),i=null!==(e=null==r?void 0:r[1])&&void 0!==e?e:"";return[o,i.toLowerCase()]}(u),v=d[0];switch(d[1]){case"rem":return v*t(i(window.document.documentElement));case"em":return v*t(i(c),null==c?void 0:c.parentElement);case"in":return v*e;case"q":return v*e/n/4;case"mm":return v*e/n;case"cm":return v*e*10/n;case"pt":return v*e/o;case"pc":return v*e/r;case"vh":return(v*s.innerHeight||f.clientWidth)/100;case"vw":return(v*s.innerWidth||f.clientHeight)/100;case"vmin":return v*Math.min(s.innerWidth||f.clientWidth,s.innerHeight||f.clientHeight)/100;case"vmax":return v*Math.max(s.innerWidth||f.clientWidth,s.innerHeight||f.clientHeight)/100;default:return v}};var t=c(),e=96,n=25.4,o=72,r=6;function i(e){return e?(0,t.getStyle)(e,"fontSize")||i(e.parentElement):(0,t.getStyle)(window.document.documentElement,"fontSize")}return s}var d=f(),v="littlefoot__tooltip";function m(t){var e=Number.parseFloat(l.getStyle(t,"marginLeft")),n=t.offsetWidth-e;return(t.getBoundingClientRect().left+n/2)/window.innerWidth}function p(t,e,r){var i=function(t,e){var n=Number.parseInt(l.getStyle(e,"marginTop"),10),o=2*n+e.offsetHeight,r=t.getBoundingClientRect().top+t.offsetHeight/2,i=window.innerHeight-r;return i>=o||i>=r?["below",i-n-15]:["above",r-n-15]}(e,t),u=i[0],c=i[1];if(r!==u){o(t,"is-"+r),n(t,"is-"+u);var a=100*m(e)+"%",s="above"===u?"100%":"0";t.style.transformOrigin=a+" "+s}return[u,c]}var h="is-active",g="is-changing",y="is-scrollable";function b(t){var e=t.id,i=t.button,u=t.content,c=t.host,a=t.popover,s=t.wrapper,f=0,b="above",w=function(){return document.body.contains(a)};return{id:e,activate:function(t){var e;i.setAttribute("aria-expanded","true"),n(i,g),n(i,h),i.insertAdjacentElement("afterend",a),a.style.maxWidth=document.body.clientWidth+"px",e=u,f=Math.round(d.pixels(l.getStyle(e,"maxHeight"),e)),null==t||t(a,i)},dismiss:function(t){i.setAttribute("aria-expanded","false"),n(i,g),o(i,h),o(a,h),null==t||t(a,i)},isActive:function(){return r(i,h)},isReady:function(){return!r(i,g)},ready:function(){n(a,h),o(i,g)},remove:function(){a.remove(),o(i,g)},reposition:function(){if(w()){var t=p(a,i,b),e=t[0],r=t[1];b=e,u.style.maxHeight=Math.min(f,r)+"px",a.offsetHeight<u.scrollHeight?(n(a,y),u.setAttribute("tabindex","0")):(o(a,y),u.removeAttribute("tabindex"))}},resize:function(){w()&&(a.style.left=function(t,e){var n=t.offsetWidth;return-m(e)*n+Number.parseInt(l.getStyle(e,"marginLeft"),10)+e.offsetWidth/2}(u,i)+"px",s.style.maxWidth=u.offsetWidth+"px",function(t,e){var n=t.querySelector("."+v);n&&(n.style.left=100*m(e)+"%")}(a,i))},destroy:function(){return c.remove()}}}var w,E={};function x(){if(w)return E;return w=1,Object.defineProperty(E,"__esModule",{value:!0}),E.throttle=function(t,e){void 0===e&&(e=0);var n,o=0;return Object.assign((function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var u=Math.max(0,o+e-Date.now());u?(clearTimeout(n),n=setTimeout((function(){o=Date.now(),t.apply(void 0,r)}),u)):(o=Date.now(),t.apply(void 0,r))}),{cancel:function(){o=0,clearTimeout(n)}})},E}var S=x(),D="is-fully-scrolled",T=function(t){return function(e){var r=e.currentTarget,i=-e.deltaY;i>0&&o(t,D),r&&i<=0&&i<r.clientHeight+r.scrollTop-r.scrollHeight&&n(t,D)}};var A="littlefoot__content",H="littlefoot__wrapper",_="littlefoot--print",O=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.forEach((function(t){return n(t,_)}))};function M(t,e){return Array.from(t.querySelectorAll(e))}function W(t,e){return t.querySelector("."+e)||t.firstElementChild||t}function L(t){var e=document.createElement("div");e.innerHTML=t;var n=e.firstElementChild;return n.remove(),n}function C(t){return void 0!==t}function P(t){var e=t.parentElement,n=M(e,":scope > :not(."+_+")"),o=n.filter((function(t){return"HR"===t.tagName}));n.length===o.length&&(O.apply(void 0,o.concat(e)),P(e))}function j(t,e){var n=t.parentElement;t.remove(),n&&n!==e&&!n.innerHTML.replace(/(\[\]|&nbsp;|\s)/g,"")&&j(n,e)}function R(t,e){var n=t[0],o=t[1],r=t[2],i=L(r.outerHTML);M(i,'[href$="#'+n+'"]').forEach((function(t){return j(t,i)}));var u=i.innerHTML.trim();return[o,r,{id:String(e+1),number:e+1,reference:"lf-"+n,content:u.startsWith("<")?u:"<p>"+u+"</p>"}]}function k(t){return function(e){return t.replace(/<%=?\s*(\w+?)\s*%>/g,(function(t,n){var o;return String(null!==(o=e[n])&&void 0!==o?o:"")}))}}function z(t,e){var n=k(t),o=k(e);return function(t){var e=t[0],r=t[1],i=r.id,u=L('<span class="littlefoot">'+n(r)+"</span>"),c=u.firstElementChild;c.setAttribute("aria-expanded","false"),c.dataset.footnoteButton="",c.dataset.footnoteId=i;var a=L(o(r));a.dataset.footnotePopover="",a.dataset.footnoteId=i;var l=W(a,H),s=W(a,A);return function(t,e){t.addEventListener("wheel",S.throttle(T(e),16))}(s,a),e.insertAdjacentElement("beforebegin",u),{id:i,button:c,host:u,popover:a,content:s,wrapper:l}}}function F(t){var n,r,i,u=t.allowDuplicates,c=t.anchorParentSelector,a=t.anchorPattern,l=t.buttonTemplate,s=t.contentTemplate,f=t.footnoteSelector,d=t.numberResetSelector,v=t.scope,m=function(t,e,n){return M(t,n+' a[href*="#"]').filter((function(t){return(t.href+t.rel).match(e)}))}(document,a,v).map(function(t,e,n,o){var r=[];return function(i){var u,c=i.href.split("#")[1];if(c){var a=null===(u=M(t,"#"+window.CSS.escape(c)).find((function(t){return e||!r.includes(t)})))||void 0===u?void 0:u.closest(o);if(a){r.push(a);var l=i.closest(n)||i;return[l.id||i.id,l,a]}}}}(document,u,c,f)).filter(C).map(R).map(d?(n=d,r=0,i=null,function(t){var o=t[0],u=t[1],c=t[2],a=o.closest(n);return r=i===a?r+1:1,i=a,[o,u,e(e({},c),{number:r})]}):function(t){return t}).map((function(t){var e=t[0],n=t[1],o=t[2];return O(e,n),P(n),[e,o]})).map(z(l,s)).map(b);return{footnotes:m,unmount:function(){m.forEach((function(t){return t.destroy()})),M(document,"."+_).forEach((function(t){return o(t,_)}))}}}var I="[data-footnote-id]",q=function(t){var e;if(t){console.log("found a copy button for footnode id: ",t);var n=null===(e=document.getElementById(t))||void 0===e?void 0:e.innerText;n&&navigator.clipboard.writeText(n).then((function(){console.log("Footnote content copied: ",n),alert("Footnote copied to clipboard!")})).catch((function(t){console.error("Failed to copy text: ",t)}))}},N=function(t,e){return t.target.closest(e)},B=function(t){return null==t?void 0:t.dataset.footnoteId},V=function(t){return function(e){e.preventDefault();var n=N(e,I),o=B(n);o&&t(o)}},U=document.addEventListener,Y=window.addEventListener,$=function(t,e,n,o){return U(t,(function(t){var o=t.target;(null==o?void 0:o.closest(e))&&n.call(o,t)}),o)};var G={activateDelay:100,activateOnHover:!1,allowDuplicates:!0,allowMultiple:!1,anchorParentSelector:"sup",anchorPattern:/(fn|footnote|note)[:\-_\d]/gi,dismissDelay:100,dismissOnUnhover:!1,dismissOnDocumentTouch:!0,footnoteSelector:"li",hoverDelay:250,numberResetSelector:"",scope:"",contentTemplate:'<aside class="littlefoot__popover" id="fncontent:<% id %>"><div class="'.concat(H,'"><div class="').concat(A,'"><% content %></div></div><div class="').concat(v,'"></div></aside>'),buttonTemplate:'<button class="littlefoot__button" id="<% reference %>" title="See Footnote <% number %>"><svg role="img" aria-labelledby="title-<% reference %>" viewbox="0 0 31 6" preserveAspectRatio="xMidYMid"><title id="title-<% reference %>">Footnote <% number %></title><circle r="3" cx="3" cy="3" fill="white"></circle><circle r="3" cx="15" cy="3" fill="white"></circle><circle r="3" cx="27" cy="3" fill="white"></circle></svg></button>'};function J(t){void 0===t&&(t={});var n=e(e({},G),t),o=function(t,e){var n,o=t.footnotes,r=t.unmount,i=function(t){return function(n){n.isReady()&&(n.dismiss(e.dismissCallback),setTimeout(n.remove,t))}},u=function(t){return function(n){e.allowMultiple||o.filter((function(t){return t.id!==n.id})).forEach(i(e.dismissDelay)),n.isReady()&&(n.activate(e.activateCallback),n.reposition(),n.resize(),setTimeout(n.ready,t))}},c=function(t){return function(e){var n=o.find((function(t){return t.id===e}));n&&t(n)}},a=function(){return o.forEach(i(e.dismissDelay))};return{activate:function(t,e){return c(u(e))(t)},dismiss:function(t,e){return c(i(e))(t)},dismissAll:a,touchOutside:function(){e.dismissOnDocumentTouch&&a()},repositionAll:function(){return o.forEach((function(t){return t.reposition()}))},resizeAll:function(){return o.forEach((function(t){return t.resize()}))},toggle:c((function(t){return t.isActive()?i(e.dismissDelay)(t):u(e.activateDelay)(t)})),hover:c((function(t){n=t.id,e.activateOnHover&&!t.isActive()&&u(e.hoverDelay)(t)})),unhover:c((function(t){t.id===n&&(n=null),e.dismissOnUnhover&&setTimeout((function(){return o.filter((function(t){return t.id!==n})).forEach(i(e.dismissDelay))}),e.hoverDelay)})),unmount:r}}(F(n),n),r=function(t){var e=function(e){var n=N(e,"[data-footnote-button]"),o=B(n);o?(e.preventDefault(),t.toggle(o)):N(e,"[data-footnote-popover]")||t.touchOutside()},n=S.throttle(t.repositionAll,16),o=S.throttle(t.resizeAll,16),r=V(t.hover),i=V(t.unhover),u=new AbortController,c={signal:u.signal};return U("touchend",e,c),U("click",(function(e){if(N(e,"[data-footnote-popover]")){var n=document.querySelector(".copy-footnote");if(n){var o=n.getAttribute("footnote-id");q(o)}else t.touchOutside()}}),c),U("click",e,c),U("keyup",(function(e){27!==e.keyCode&&"Escape"!==e.key&&"Esc"!==e.key||t.dismissAll()}),c),U("gestureend",n,c),Y("scroll",n,c),Y("resize",o,c),$("mouseover",I,r,c),$("mouseout",I,i,c),function(){u.abort()}}(o);return{activate:function(t,e){void 0===e&&(e=n.activateDelay),o.activate(t,e)},dismiss:function(t,e){void 0===e&&(e=n.dismissDelay),void 0===t?o.dismissAll():o.dismiss(t,e)},unmount:function(){r(),o.unmount()},getSetting:function(t){return n[t]},updateSetting:function(t,e){n[t]=e}}}t.default=J,t.littlefoot=J,Object.defineProperty(t,"__esModule",{value:!0})}));
